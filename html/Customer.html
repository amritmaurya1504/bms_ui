<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Management</title>
    <link rel="stylesheet" href="../css/Customer.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo" onclick="window.location.href='../index.html'">Bank Management System</div>
        <hr />
        <ul>
            <li><a href="Home.html">Dashboard</a></li>
            <li><a href="Customer.html" class="active">Customer Management</a></li>
            <li><a href="Transaction.html">Transactions</a></li>
            <li><a href="Loan.html">Loan Management</a></li>
            <li><a href="#">Logout</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h1>Customer Management</h1>

        <!-- Buttons for toggling views -->
        <div class="button-container">
            <button id="viewCustomersBtn" style="display: none;">View Customers</button>
            <button id="addCustomerBtn">Add New Customer</button>
        </div>

        <!-- Customer Registration Form (Initially Hidden) -->
        <div class="customer-form" id="customerFormContainer" style="display: none;">
            <h2>Register New Customer</h2>
            <form id="customerForm" class="grid-form">
                <div class="grid-item">
                    <label for="ssn">Customer SSN ID:</label>
                    <input type="text" id="ssn" required>
                </div>

                <div class="grid-item">
                    <label for="name">Customer Name:</label>
                    <input type="text" id="name" required>
                </div>
                <div class="grid-item">
                    <label for="account">Account Number:</label>
                    <input type="text" id="account" required>
                </div>

                <div class="grid-item">
                    <label for="ifsc">IFSC Code:</label>
                    <input type="text" id="ifsc" required>
                </div>

                <div class="grid-item">
                    <label for="balance">Account Balance:</label>
                    <input type="number" id="balance" required>
                </div>

                <div class="grid-item">
                    <label for="aadhaar">Aadhaar Card No.:</label>
                    <input type="text" id="aadhaar" required>
                </div>

                <div class="grid-item">
                    <label for="pan">PAN Card No.:</label>
                    <input type="text" id="pan" required>
                </div>

                <div class="grid-item">
                    <label for="dob">Date of Birth:</label>
                    <input type="date" id="dob" required>
                </div>
                <div class="grid-item">
                    <label for="gender">Gender</label>
                    <select id="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="grid-item">
                    <label for="marital">Marital Status</label>
                    <select id="marital" required>
                        <option value="">Select Marital Status</option>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Divorced">Divorced</option>
                        <option value="Widowed">Widowed</option>
                    </select>
                </div>

                <div class="grid-item">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="grid-item">
                    <label for="contact">Contact Number</label>
                    <input type="text" id="contact" required>
                </div>
                <div class="grid-full">
                    <label for="address">Address</label>
                    <textarea id="address" placeholder="Street, City, etc." maxlength="100" required></textarea>
                </div>
                <button type="submit">Register Customer</button>
            </form>
        </div>

        <!-- Customer List -->
        <div class="customer-list" id="customerList">
            <h2>Registered Customers</h2>
            <table>
                <tr>
                    <th>SSN ID</th>
                    <th>Name</th>
                    <th>Account No</th>
                    <th>IFSC</th>
                    <th>Balance</th>
                    <th>Aadhaar</th>
                    <th>PAN</th>
                    <th>DOB</th>
                    <th>Actions</th>
                </tr>
                <tr>
                    <td>123456789</td>
                    <td>John Doe</td>
                    <td>1234567890</td>
                    <td>SBIN0001234</td>
                    <td>₹50,000</td>
                    <td>1234-5678-9012</td>
                    <td>ABCDE1234F</td>
                    <td>1990-05-15</td>
                    <td>
                        <button class="editBtn">Edit</button>
                        <button class="deleteBtn">Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>123456789</td>
                    <td>Amrit Raj</td>
                    <td>1234567890</td>
                    <td>SBIN0001234</td>
                    <td>₹50,000</td>
                    <td>1234-5678-9012</td>
                    <td>ABCDE1234F</td>
                    <td>1990-05-15</td>
                    <td>
                        <button class="editBtn">Edit</button>
                        <button class="deleteBtn">Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>123456789</td>
                    <td>John Doe</td>
                    <td>1234567890</td>
                    <td>SBIN0001234</td>
                    <td>₹50,000</td>
                    <td>1234-5678-9012</td>
                    <td>ABCDE1234F</td>
                    <td>1990-05-15</td>
                    <td>
                        <button class="editBtn">Edit</button>
                        <button class="deleteBtn">Delete</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadCustomers(); // Load existing customers from localStorage
    
            document.getElementById("addCustomerBtn").addEventListener("click", function () {
                document.getElementById("customerFormContainer").style.display = "block";
                document.getElementById("customerList").style.display = "none";
                document.getElementById("addCustomerBtn").style.display = "none";
                document.getElementById("viewCustomersBtn").style.display = "inline-block";
            });
    
            document.getElementById("viewCustomersBtn").addEventListener("click", function () {
                document.getElementById("customerFormContainer").style.display = "none";
                document.getElementById("customerList").style.display = "block";
                document.getElementById("addCustomerBtn").style.display = "inline-block";
                document.getElementById("viewCustomersBtn").style.display = "none";
            });
    
            document.getElementById("customerForm").addEventListener("submit", function (event) {
                event.preventDefault();
                addCustomer();
            });
        });
    
        function generateUniqueSSN() {
            let customers = JSON.parse(localStorage.getItem('customers')) || [];
            let ssnNumbers = customers.map(c => c.ssn);
            let newSSN;
    
            do {
                newSSN = Math.floor(100000000 + Math.random() * 900000000); // 9-digit unique SSN
            } while (ssnNumbers.includes(newSSN.toString()));
    
            return newSSN.toString();
        }
    
        function addCustomer() {
            const name = document.getElementById('name').value.trim();
            const account = document.getElementById('account').value.trim();
            const ifsc = document.getElementById('ifsc').value.trim();
            const balance = document.getElementById('balance').value.trim();
            const aadhaar = document.getElementById('aadhaar').value.trim();
            const pan = document.getElementById('pan').value.trim();
            const dob = document.getElementById('dob').value.trim();
            const gender = document.getElementById('gender').value.trim();
            const marital = document.getElementById('marital').value.trim();
            const email = document.getElementById('email').value.trim();
            const contact = document.getElementById('contact').value.trim();
            const address = document.getElementById('address').value.trim();
            const ssn = generateUniqueSSN();
    
            if (!name || !account || !ifsc || !balance || !aadhaar || !pan || !dob || !gender || !marital || !email || !contact || !address) {
                alert("All fields are required!");
                return;
            }
    
            let customer = {
                ssn,
                name,
                account,
                ifsc,
                balance,
                aadhaar,
                pan,
                dob,
                gender,
                marital,
                email,
                contact,
                address
            };
    
            let customers = JSON.parse(localStorage.getItem('customers')) || [];
            customers.push(customer);
            localStorage.setItem('customers', JSON.stringify(customers));
    
            alert("Customer Registered Successfully!");
            document.getElementById("customerForm").reset();
            loadCustomers();
        }
    
        function loadCustomers() {
            let customers = JSON.parse(localStorage.getItem('customers')) || [];
            let table = `<tr>
                        <th>SSN ID</th>
                        <th>Name</th>
                        <th>Account No</th>
                        <th>IFSC</th>
                        <th>Balance</th>
                        <th>Aadhaar</th>
                        <th>PAN</th>
                        <th>DOB</th>
                        <th>Actions</th>
                    </tr>`;
    
            customers.forEach((customer, index) => {
                table += `<tr>
                        <td>${customer.ssn}</td>
                        <td>${customer.name}</td>
                        <td>${customer.account}</td>
                        <td>${customer.ifsc}</td>
                        <td>₹${customer.balance}</td>
                        <td>${customer.aadhaar}</td>
                        <td>${customer.pan}</td>
                        <td>${customer.dob}</td>
                        <td>
                            <button class="editBtn" onclick="editCustomer(${index})">Edit</button>
                            <button class="deleteBtn" onclick="deleteCustomer(${index})">Delete</button>
                        </td>
                    </tr>`;
            });
    
            document.querySelector("#customerList table").innerHTML = table;
        }
    
        function deleteCustomer(index) {
            let customers = JSON.parse(localStorage.getItem('customers')) || [];
            customers.splice(index, 1);
            localStorage.setItem('customers', JSON.stringify(customers));
            loadCustomers();
        }
    
        function editCustomer(index) {
            let customers = JSON.parse(localStorage.getItem('customers')) || [];
            let customer = customers[index];
    
            document.getElementById("name").value = customer.name;
            document.getElementById("account").value = customer.account;
            document.getElementById("ifsc").value = customer.ifsc;
            document.getElementById("balance").value = customer.balance;
            document.getElementById("aadhaar").value = customer.aadhaar;
            document.getElementById("pan").value = customer.pan;
            document.getElementById("dob").value = customer.dob;
            document.getElementById("gender").value = customer.gender;
            document.getElementById("marital").value = customer.marital;
            document.getElementById("email").value = customer.email;
            document.getElementById("contact").value = customer.contact;
            document.getElementById("address").value = customer.address;
    
            deleteCustomer(index); // Remove the old record so the new one can be added after updating
            document.getElementById("customerFormContainer").style.display = "block";
            document.getElementById("customerList").style.display = "none";
            document.getElementById("addCustomerBtn").style.display = "none";
            document.getElementById("viewCustomersBtn").style.display = "inline-block";
        }
    </script>
    
</body>

</html>